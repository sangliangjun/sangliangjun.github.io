<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="大模型量化技术（Quantization）可视化指南, ZejunCao&#39;Blogs">
    <meta name="description" content="大模型量化技术（Quantization）可视化指南

仅用于站内搜索，没有排版格式，具体信息请跳转上方微信公众号内链接

原文：https :&amp;#x2F;&amp;#x2F;www.maartengrootendorst.com/blog/qua">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>大模型量化技术（Quantization）可视化指南 | ZejunCao&#39;Blogs</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 7.3.0"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">ZejunCao&#39;Blogs</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">ZejunCao&#39;Blogs</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/frontcover/1000002563_2648996796_1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">大模型量化技术（Quantization）可视化指南</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95%E4%B8%8EPython%E5%AE%9E%E6%88%98/">
                                <span class="chip bg-color">机器学习算法与Python实战</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2025-03-21
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/L162LDMXXzAlTQhEcuOiMw">大模型量化技术（Quantization）可视化指南</a></p>
<blockquote>
<p>仅用于站内搜索，没有排版格式，具体信息请跳转上方微信公众号内链接</p>
</blockquote>
<p>原文：https :&#x2F;&#x2F;<a target="_blank" rel="noopener" href="http://www.maartengrootendorst.com/blog/quantization/">www.maartengrootendorst.com/blog/quantization/</a><br>顾名思义，大型语言模型的规模通常过于庞大，难以在消费级硬件上运行。这类模型的参数量可达数十亿级别，通常需要配备大容量显存的GPU来加速推理过程。<br>为此，越来越多的研究聚焦于通过优化训练方式、引入适配器等技术缩小模型规模。其中一项关键技术便是量化。<br>本文将以语言建模为背景，系统介绍量化技术领域，通过逐层剖析核心概念助您建立直观认知。我们将深入解析量化的各类方法、实际应用场景及其底层原理。<br>作为可视化指南，文中将包含大量图表辅助建立量化技术的直观理解！<br>LLM的名称源于其庞大的参数规模。当今主流模型通常包含数十亿参数（主要为权重），其存储开销极为昂贵。<br>在推理过程中，激活值由输入数据与权重相乘产生，其规模同样可能非常庞大。<br>因此，我们需要以最高效的方式表示数十亿个数值，最大限度减少存储特定值所需的空间占用。<br>让我们从基本原理出发，在探讨优化方法之前，先深入理解数值的原始表示方式。<br>数值通常以浮点数（计算机科学中称为floats）形式表示，即带有小数点的正负实数。<br>这些数值通过「比特位数」（二进制数字）进行编码。IEEE-754标准定义了如何用比特位数构成三个功能组件来表示数值：符号位、指数位以及小数位（或称尾数）。<br>通过这三个组件的比特值组合，可计算出对应的具体数值：<br>一般而言，分配的比特位数越多，数值表示的精度就越高：<br>可用的比特位数越多，所能表示的数值范围就越大。<br>特定表示方法所能容纳的数值区间称为动态范围，而相邻两个数值之间的间隔则称为精度。<br>这些比特位数具备一个实用特性：可精确计算设备存储给定数值所需的内存空间。鉴于8比特(bit)组成1字节(byte)，我们可以为大多数浮点表示方法建立基础计算公式。<br>注意：实际应用中，推理过程所需的(V)RAM容量还需考虑其他因素，例如上下文长度和模型架构设计。<br>现在假设我们有一个包含700亿个参数的模型。大多数模型原生采用32位浮点数（常称为全精度）表示，仅加载模型就需要占用280GB内存空间。<br>因此，尽可能减少表示模型参数所需的比特位数（在训练过程中也是如此！）变得极具必要性。然而，随着精度的降低，模型的准确性通常也会随之下降。<br>我们希望在减少数值表示所需比特位数的同时保持准确性……这正是量化技术的关键价值所在！<br>量化的核心目标是将模型参数从高位宽表示（如32位浮点数）转换为低位宽表示（如8位整数）。<br>当减少用于表示原始参数的比特位数时，通常会导致一定程度的精度损失（表现为粒度降低）。<br>为了直观演示这种效果，我们可以任取一张图像，仅使用8种色彩来呈现它：<br>本图片基于SlavaSidorov的原作进行修改并适配。<br>注意放大后的区域相较于原图显得更‘粗糙’，这是因为我们使用了更少的颜色来进行表示。量化的核心目标是通过减少表征原始参数所需的比特位数（类比颜色数量），在最大限度保持参数原始精度的前提下实现高效存储<br>首先，我们对比分析常规数据类型与32位（即全精度或FP32）表示方式的差异：<br>以下展示从32位浮点格式（FP32）转换为16位浮点格式（即半精度或FP16）的实例：<br>值得注意的是，FP16的数值表示范围相较FP32存在显著缩减<br>为实现与原始FP32相近的数值覆盖范围，研究者提出了_bfloat16_（BF16）这种“截断式FP32”的浮点格式：<br>BF16虽然与FP16占用相同的存储空间（16位），但其数值表示范围更广，因此被广泛应用于深度学习领域。<br>当我们将比特位数进一步降低时，便会进入基于整数的表示方法范畴，而不再使用浮点表示法。以FP32浮点格式转换为8比特的INT8为例，其比特位数将缩减至原始值的四分之一：<br>具体硬件条件下，基于整数的运算速度可能优于浮点运算，但这一优势并非绝对成立。然而，通常当使用较少比特位数时，计算速度会显著提升。<br>每减少一个比特位，都需要通过映射操作将初始的FP32浮点表示’压缩’到更低位宽中。<br>实际上，我们无需将完整的FP32范围[-3.4e38,3.4e38]映射到INT8，只需找到将模型参数的实际数据范围适配到INT8的方法即可。<br>常见的压缩&#x2F;映射方法包括对称量化和非对称量化，这些都属于线性映射的范畴。<br>接下来我们将具体分析这些从FP32到INT8的量化方法。<br>对称量化的核心原理是将原始浮点数值范围对称地映射到以零为中心的量化空间。通过前文示例可以观察到，量化前后的数值分布始终保持着以零为中心的对称特性。<br>这种方法的显著特征是：浮点空间中的零值经过量化后，在量化空间中仍精确保持为零值。<br>对称量化的一种典型形式称为绝对值最大（absmax）量化。<br>给定一组数值，我们以最高绝对值（α）作为范围来进行线性映射。<br>注意数值范围[-127,127]表示受限区间。无约束范围设定为[-128,127]，具体取值取决于所采用的量化方法。<br>由于该映射是以零为中心的线性变换，其计算公式较为简明。<br>我们通过以下公式计算比例因子（s）：<br>其中b表示目标量化字节数（8字节），<br>α表示输入张量中的最大绝对值，<br>随后使用计算得到的比例因子s对输入值x执行量化：<br>代入实际数值后可得以下表达式：<br>若要还原原始FP32浮点格式数值，可使用先前计算的比例因子（s）对量化值进行逆量化。<br>量化解量化过程还原原始值的操作流程如下：<br>可见部分数值（如3.08和3.02）在INT8量化时均被映射为整数值36。当将数值解量化恢复为FP32浮点格式时，其精度会有所损失且无法再保持原有的区分度。<br>这种现象通常被称为量化误差，可通过计算原始值与解量化值之间的差值来量化评估。<br>通常使用的比特位数越少，产生的量化误差往往越大。<br>与对称量化不同，非对称量化的数值分布并不以零点为对称中心。该方法将浮点数值范围的最小值（β）和最大值（α）分别映射至量化范围的极值区间。<br>我们将要深入探讨的方法被称为零点量化。<br>是否注意到零点位置发生了偏移？这正是其被称为非对称量化的原因。在[-7.59,10.8]数值范围内，最小值与最大值到零点的距离呈现不对称性。<br>基于零点的位置偏移特性，需计算INT8数值范围的零点值以实现精确的线性映射。与对称量化类似，我们仍需计算比例因子（_s_），但此时使用INT8取值范围[-128,127]的差值进行计算：<br>需要注意的是，由于该方法要求计算INT8范围内的零点（_z_）用于权重调整，操作步骤相对复杂。依照既定方法，我们代入量化公式：<br>若要将INT8量化模型解量化回FP32格式，需使用预先计算的比例因子（_s_）和零点参数（_z_）<br>除此之外，解量化过程本身较为直观：<br>将对称量化与非对称量化方法并列对比时，二者的核心差异立即可辨：<br>请注意对称量化天然的零中心特性与非对称量化的偏移分布形成鲜明对比<br>在前文案例中，我们已深入解析如何将向量值域映射至低比特位表示的方法尽管这种方法可以映射向量的全部取值范围，但它存在一个显著缺陷——即会产生离群值。<br>假设存在如下取值的向量：<br>注意观察其中一个值明显大于其他所有值，可视为离群值。若将该向量的全部取值范围进行映射，则所有较小值都会被压缩至相同的低比特表示形式，从而丧失其差异性特征：<br>这正是前文使用的absmax量化方法。需注意的是，若不实施截断操作，非对称量化同样会出现类似现象。<br>作为替代方案，我们可以选择_截断_特定数值。截断的核心在于重新设定原始值的动态范围，使得所有异常值统一归为相同数值。<br>如下例所示，若手动将动态范围设定为[-5,5]，该区间外的所有值无论大小都将被统一映射为-127或127：<br>该方法的核心优势在于能大幅降低正常值域数据的量化误差。但相应地，异常值数据的量化误差会增大。<br>本例中展示的是通过主观选择[-5,5]范围的简易实现方式。该范围的选择过程称为_校准_，其核心目标是寻找既能覆盖最大数据量又能最小化量化误差的最优区间。<br>需注意，不同类型的参数在执行此校准步骤时存在差异性。<br>由于大语言模型（LLM）的权重和偏置项在模型运行前就已确定，因此可将其视为静态参数。以Llama3约20GB的模型文件为例，其主要构成部分即为权重和偏置项。<br>鉴于偏置项数量级（百万级）远小于权重参数（十亿级），通常采用更高精度（如INT16）存储偏置项，而量化优化的核心目标集中在权重处理。<br>针对已知且保持静态的权重参数，选择量化范围的校准技术主要包括：<br>手动选定输入范围的百分位点；<br>通过优化原始权重与量化权重之间的均方误差（MSE）进行校准；<br>最小化原始数据与量化值间的信息熵（KL散度）。<br>若采用百分位数选择策略，将产生与先前讨论相似的数值截断现象。<br>在大型语言模型（LLM）中持续更新的输入通常被称为「激活值」。<br>需要注意的是，这些数值之所以称为激活值，是因为它们通常会通过某些激活函数（如Sigmoid或ReLU）进行处理。<br>与权重不同，在推理过程中，激活值会随着输入数据的变化而动态改变，因此对其进行精确量化颇具挑战。<br>由于这些数值会在每个隐藏层处理后更新，我们只有在模型执行推理、输入数据流经网络时才能确定其具体值。<br>总体而言，校准权重和激活值的量化方法可分为两大类：<br>训练后量化（PTQ）<br>训练完成后量化<br>量化感知训练（QAT）<br>训练&#x2F;微调过程中量化<br>训练后量化（PTQ）是目前最主流的量化方法之一。该技术要求在模型完成训练后，对其参数（含权重和激活值）执行量化操作。<br>权重的量化可采用对称量化或非对称量化方法。而激活值的量化则需通过模型推理获取其潜在分布，因其数值范围无法预先确定。激活值的量化主要包含两种形式：<br>动态量化<br>静态量化<br>当数据通过隐藏层后，系统会收集其产生的激活值：<br>基于这些激活值的分布特征，可计算出量化输出所需的零点(z)和比例因子(s)：<br>该过程会在数据每次流经新的网络层时重复执行因此，每个网络层都具有独立的z和s参数值，从而形成差异化的量化方案。<br>与动态量化不同，静态量化不在推理过程中实时计算零点(z)和比例因子(s)，而是采用预先计算的方式。为确定这些参数值，需使用校准数据集输入模型以收集潜在的数据分布：<br>完成数据收集后，即可计算出推理阶段执行量化所需的s和z参数值。在实际执行推理时，s和z参数值不会实时计算，而是采用全局统一值对所有激活值进行量化处理。<br>总体而言，动态量化通常具有更高精度，因其专门针对每个隐藏层独立计算s和z参数值。但这种方式可能增加计算耗时，需实时执行参数值的计算过程。<br>相较之下，静态量化虽然精度稍逊，但由于已预存固定的s和z量化参数，执行效率显著更高。<br>实践证明，突破8比特以下的量化存在显著挑战，量化误差会随着比特位数的减少呈指数级增长。当前主要通过智能量化策略实现6比特、4比特乃至2比特的突破（但行业普遍不建议采用低于4比特的方案）。<br>我们将深入解析HuggingFace社区广泛采用的两种代表性方法：<br>GPTQ（全模型GPU部署方案）<br>GGUF（支持部分层CPU卸载方案）<br>GPTQ算法堪称4比特量化领域最著名的实践方法之一1<br>该算法采用非对称量化方法，并逐层进行处理：每一层在进入下一层前均独立完成量化：<br>在此逐层量化过程中，算法首先将层的权重转换为逆海森矩阵作为模型损失函数的二阶导数，海森矩阵揭示了模型输出对各个权重变化的敏感程度。简而言之，它实际上反映了层中每个权重的（逆）重要性<br>与海森矩阵中较小值对应的权重更为关键，因为这些权重的微小扰动可能导致模型性能的显著波动<br>在逆海森矩阵中，数值越低表示该权重越“重要”。<br>接下来，我们首先对权重矩阵中第一行的权重进行量化，随后执行解量化操作：<br>通过该过程，我们可以计算量化误差（q），并利用预先计算的逆海森矩阵（）对其进行加权处理。本质上，我们基于权重的重要性创建了一个加权量化误差：<br>接下来，我们将这个加权量化误差重新分配到该行中的其他权重上，从而保持网络的整体功能和输出特性。<br>例如，针对第二个权重（即0.3（）），我们会将量化误差（）乘以该权重的逆海森矩阵值（）后进行累加：<br>我们可以对当前行中的第三个权重执行相同操作：<br>我们持续迭代执行这种加权量化误差的重新分配过程，直至所有权重值完成量化。<br>该方法行之有效的原因在于，神经网络中的权重通常具有相互关联性。因此，当某个权重出现量化误差时，相关权重会通过逆海森矩阵（inverse-Hessian）进行协同更新。<br>注意：研究者采用了多项优化技巧以提升计算效率和模型性能，包括为海森矩阵引入阻尼因子、实施「惰性批处理」策略，以及采用Cholesky分解进行信息预计算。我们强烈推荐观看该YouTube技术讲解视频以深入理解本主题。<br>技术提示：如需针对推理速度进行极致优化的量化方案，请重点关注EXL2框架的实现。<br>虽然GPTQ算法是实现大型语言模型全量GPU部署的优秀量化方案，但在实际硬件条件受限时，此时可借助GGUF格式的层级卸载特性，将模型任意计算层动态分配至CPU执行。2<br>当显存（VRAM）不足时，该方案允许您同时利用CPU和GPU进行协同计算。<br>GGUF量化方法迭代更新频繁，其具体实现可能因位量化级别的不同而有所差异。然而，其通用量化原理可概括如下：<br>首先，将神经网络某层的权重矩阵分割为多个’超块’，每个超块包含若干’子块’集合。从这些区块结构中，可提取出比例因子（s）和alpha参数（α）：<br>对于特定’子块’的量化处理，可采用先前所述的absmax绝对值最大化量化方法。需特别注意，该方法通过将权重值与比例因子（s）相乘实现量化缩放：<br>比例因子虽基于’子块’数据计算得出，但最终需使用’超块’的独立比例因子完成量化过程：<br>这种分层量化机制利用’超块’的比例因子（）对’子块’比例因子（）进行二次量化。<br>各比例因子的量化级别可能不同，通常’主’模块的比例因子比’子’模块具有更高的精度。<br>为便于理解，我们将以三种量化位宽（2位、4位和6位）为例进行说明：<br>技术说明：根据量化类型的不同，需通过附加最小值参数（m）对零点进行校准。这些量化模型的量化方式与比例因子（s）保持一致。<br>关于所有量化级别的概述，请参考原始拉取请求。如需了解基于重要性矩阵的量化方法，请查阅此拉取请求。<br>在第三部分中，我们演示了如何在模型训练完成后实施量化操作。该方法的局限性在于：量化过程未与模型实际训练流程相结合。<br>量化感知训练（QAT）正是为此而设计。区别于训练后量化（PTQ）的事后处理方式，QAT通过在训练过程中同步学习量化参数来实现优化。<br>由于量化误差在训练阶段即被纳入优化目标，QAT相比PTQ具有更高的精度优势。具体实现流程如下：<br>在训练过程中，会引入所谓的「fake」伪量化操作。该过程首先将权重量化至INT4等低精度格式，随后反量化为FP32浮点格式：<br>通过这种方式，模型可以在训练过程中将量化过程纳入考量，包括损失计算和权重更新的全过程。<br>量化感知训练（QAT）致力于寻找「wide」宽域极小值以降低量化误差，因为「narrow」窄域极小值通常会产生更大的量化误差。<br>例如，假设在反向传播过程中未考虑量化效应。根据梯度下降算法，我们会选择损失值最小的权重参数。然而，若该权重处于「narrow」窄域极小值区域，将会引发较大的量化误差。<br>相反地，若将量化纳入考量，则会在「wide」宽域极小值区域选择不同的更新权重，从而显著降低量化误差。<br>因此，尽管训练后量化（PTQ）在高精度（如FP32浮点格式）下表现更优，但量化感知训练（QAT）在低精度（如INT4）下的实际部署效果更佳，这正是量化技术追求的目标。<br>如先前所述，4位量化已属极小规模，但若进一步压缩至更低位宽会如何？<br>比特网络应运而生，其采用单1位量化表示模型权重，每个权重仅取**-1或1<strong>两种值。3<br>该方法通过将量化过程深度集成至Transformer架构实现。<br>值得注意的是，作为多数大型语言模型基石的Transformer架构，其核心计算单元由线性层构成：<br>这些线性层通常以FP16浮点格式等高精度数值表示，且承载了模型绝大部分权重参数。<br>比特网络通过其创新设计的比特线性层替代传统线性层：<br>比特线性层与标准线性层功能一致，通过权重矩阵与激活值的乘积运算生成输出结果。<br>相比之下，比特线性层采用1位量化表示模型权重，并利用INT8格式编码激活值：<br>与量化感知训练（QAT）类似，比特线性层在训练过程中会执行’模拟量化’操作，用于评估权重和激活值量化后的效果：<br>技术说明：原论文使用γ作为参数符号，但为保持与本文示例符号体系一致，此处统一采用α。需特别指出，此处的β参数与零点量化中的定义不同，它表示平均绝对值。<br>下面我们将分步骤详解比特线性层的实现机制。<br>在训练阶段，权重首先以INT8格式存储，随后通过_符号函数_的基础策略量化为1位精度。<br>其核心原理是将权重分布中心归零处理：将零值左侧数据统一映射为-1，右侧数据映射为1。<br>系统会持续追踪β（平均绝对值</strong>）**参数，该值将用于后续的逆量化过程。<br>在激活值量化环节，比特线性层运用绝对值最大化量化技术，将FP16格式的激活值转换为INT8精度，以满足矩阵乘法（×）运算的高精度要求。<br>系统会持续记录α（最大绝对值）参数，该值将用于后续的逆量化过程。<br>我们持续追踪了α（激活值的最大绝对值）和β（权重的平均绝对值），这些参数将帮助我们将激活值解量化回FP16浮点格式。<br>输出激活值通过{α,γ}参数组进行重新缩放，以将其逆量化为原始精度：<br>至此流程完成！该方法相对简单直观，使得模型仅需用-1和1两个数值即可表征。<br>应用此方法后，研究者发现模型规模越大，1位量化模型与全精度FP16训练模型之间的性能差异越小。<br>但此现象仅存在于大型模型（参数量&gt;300亿），较小模型的性能差距仍较为明显。<br>比特网络1.58b的提出旨在改进前文所述的扩展性问题4<br>这种创新方法中，每个权重不仅可以是-1或1，现在还可取0作为值，从而形成三元权重体系。值得注意的是，仅引入0值就显著提升了比特网络的性能，并大幅加速了计算过程。<br>为何添加0值能产生如此显著的性能提升？其核心机制完全体现在矩阵乘法的优化上！<br>首先，我们需要理解标准矩阵乘法的基本运算原理。在进行输出计算时，需执行权重矩阵与输入向量的乘积运算。下图直观展示了权重矩阵第一层的首次乘积累加运算过程：<br>需要特别指出，该运算包含两个关键步骤：相乘（单个权重与输入值逐元素相乘）和累加（将所有乘积结果求和）。<br>与之形成对比的是，比特网络1.58b采用的三元权重机制通过以下规则有效规避了乘法运算：<br>1:需要累加当前值<br>0:舍弃当前值<br>-1：需要减去该数值时<br>因此，当权重完成1.58位量化后，我们仅需进行加法运算即可：<br>该方案不仅能大幅提升计算速度，还可实现特征筛选功能。<br>通过将指定权重置零，可直接忽略该参数，避免了传统1位表征必须进行的加减运算。<br>比特网络1.58b采用改进型绝对值均值量化方案，此方法基于先前介绍的绝对值最大化量化改进而来。<br>该方法通过压缩权重参数分布，并基于绝对均值（α）执行数值量化处理。最终将量化结果取整至-1、0或1三个离散值：<br>相较原版比特网络，激活值量化机制仅存在一项改进：激活值的缩放范围从原有的[0,2ᵇ⁻¹]区间调整为采用区间[-2ᵇ⁻¹,2ᵇ⁻¹]，而非使用绝对值最大化量化方法。<br>至此，实现1.58比特量化主要依靠两个关键技术：<br>引入0值构建三元表示[-1,0,1]<br>针对权重的绝对值均值量化<br>通过仅使用计算高效的1.58比特参数，最终我们获得了轻量化模型！</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">ZejunCao</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://zejuncao.github.io/2025/03/21/1000002563-2648996796-1/">https://zejuncao.github.io/2025/03/21/1000002563-2648996796-1/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">ZejunCao</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95%E4%B8%8EPython%E5%AE%9E%E6%88%98/">
                                    <span class="chip bg-color">机器学习算法与Python实战</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2025/03/21/1000003813-2247635920-1/">
                    <div class="card-image">
                        
                        <img src="/medias/frontcover/1000003813_2247635920_1.jpg" class="responsive-img" alt="李开复：超大模型预训练逐渐寡头化，国内将收敛至 DeepSeek、阿里、字节三家">
                        
                        <span class="card-title">李开复：超大模型预训练逐渐寡头化，国内将收敛至 DeepSeek、阿里、字节三家</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2025-03-21
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            ZejunCao
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/AI%E5%89%8D%E7%BA%BF/">
                        <span class="chip bg-color">AI前线</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2025/03/21/1000000063-2247487270-1/">
                    <div class="card-image">
                        
                        <img src="/medias/frontcover/1000000063_2247487270_1.jpg" class="responsive-img" alt="【智谷要闻】AIGC智谷×上海交通大学DeepSeek大师锻造2日营点燃AI学习热潮">
                        
                        <span class="card-title">【智谷要闻】AIGC智谷×上海交通大学DeepSeek大师锻造2日营点燃AI学习热潮</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2025-03-21
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            ZejunCao
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/AIGC%E6%99%BA%E8%B0%B7/">
                        <span class="chip bg-color">AIGC智谷</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2025</span>
            
            <a href="/about" target="_blank">ZejunCao</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/ZejunCao" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:caozejun369@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1378463428" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1378463428" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="https://weibo.com/u/5915009280" class="tooltipped" target="_blank" data-tooltip="关注我的微博: https://weibo.com/u/5915009280" data-position="top" data-delay="50">
        <i class="fab fa-weibo"></i>
    </a>



    <a href="https://www.zhihu.com/people/Garfusion/posts" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: https://www.zhihu.com/people/Garfusion/posts" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
